<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting set up (7th-9th February, Leeds) &mdash; NCAS Unified Model Introduction</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            NCAS Unified Model Introduction
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Practicals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting-setup-selfstudy.html">1. Getting Set Up (Self-Study Instructions)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working-with-suites.html">2. Working with Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">3. Running a UM suite on ARCHER2</a></li>
<li class="toctree-l1"><a class="reference internal" href="fcm-tutorial.html">4. FCM tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="solving-problems.html">5. Solving Common UM Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="further-exercises-1.html">6. Further Exercises (1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="further-exercises-2.html">7. Further Exercises (2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="rose-cylc-exercises.html">8. Rose/Cylc Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="post-processing.html">9. Post processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="useful-information.html">10. Appendix A: Useful information</a></li>
<li class="toctree-l1"><a class="reference internal" href="ssh-tasks.html">11. Appendix B: SSH FAQs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NCAS Unified Model Introduction</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Getting set up (7th-9th February, Leeds)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/getting-setup-leeds.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="getting-set-up-7th-9th-february-leeds">
<h1>Getting set up (7th-9th February, Leeds)<a class="headerlink" href="#getting-set-up-7th-9th-february-leeds" title="Link to this heading"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You <strong>MUST</strong> have PUMA, ARCHER2 and MOSRS accounts setup before starting this section.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These instructions are for use on the UM Training Course held on 7-9th February 2023.  If you are using them for self-study please contact NCAS-CMS for instructions.</p>
</div>
<section id="setup-connection-to-puma-archer2">
<h2>Setup connection to PUMA &amp; ARCHER2<a class="headerlink" href="#setup-connection-to-puma-archer2" title="Link to this heading"></a></h2>
<p>To use the UM Introduction Tutorials you will first need to ensure you can connect from the local desktop to both PUMA &amp; ARCHER2.</p>
<section id="ssh-key-files">
<h3>SSH key files<a class="headerlink" href="#ssh-key-files" title="Link to this heading"></a></h3>
<p>Before you try and connect to PUMA or ARCHER2, you need to make sure that you have the ssh-keys for both platforms available on the local desktop.</p>
<p>Hopefully you remembered to bring your ssh-keys with you on a USB stick. Please talk to a course tutor if you have forgotten them.</p>
<p>Copy your ssh-keys from the USB stick to the <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code> directory.</p>
</section>
<section id="connecting-via-a-terminal-gnu-linux-macos">
<h3>Connecting via a Terminal (GNU/Linux &amp; macOS)<a class="headerlink" href="#connecting-via-a-terminal-gnu-linux-macos" title="Link to this heading"></a></h3>
<p>Connect via a terminal with an X11 connection (<a class="reference external" href="https://www.xquartz.org/">XQuartz</a> is also required when using macOS)</p>
<p>Login to PUMA:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">-</span><span class="n">Y</span> <span class="o">-</span><span class="n">i</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa_puma</span> <span class="o">&lt;</span><span class="n">puma</span><span class="o">-</span><span class="n">username</span><span class="o">&gt;@</span><span class="mf">192.171.169.138</span>
</pre></div>
</div>
<p>We suggest adding an entry to the <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> file so you don’t need to keep typing in the IP address. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Host</span> <span class="n">puma</span>
<span class="n">Hostname</span> <span class="mf">192.171.169.138</span>
<span class="n">User</span> <span class="o">&lt;</span><span class="n">puma_username</span><span class="o">&gt;</span>
<span class="n">IdentityFile</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa_puma</span>
<span class="n">ForwardX11</span> <span class="n">yes</span>
<span class="n">ForwardX11Trusted</span> <span class="n">yes</span>
</pre></div>
</div>
<p>so that you can then connect using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">puma</span>
</pre></div>
</div>
<p>In a new terminal window, login to ARCHER2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">-</span><span class="n">Y</span> <span class="o">-</span><span class="n">i</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa_archer</span> <span class="o">&lt;</span><span class="n">archer2</span><span class="o">-</span><span class="n">username</span><span class="o">&gt;</span><span class="nd">@login</span><span class="o">.</span><span class="n">archer2</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span>
</pre></div>
</div>
<p>Again you could define a <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> file entry for each with the necessary information, if desired. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Host</span> <span class="n">login</span><span class="o">.</span><span class="n">archer2</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span>
<span class="n">User</span> <span class="o">&lt;</span><span class="n">archer2_username</span><span class="o">&gt;</span>
<span class="n">IdentityFile</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa_archer</span>
<span class="n">ForwardX11</span> <span class="n">yes</span>
<span class="n">ForwardX11Trusted</span> <span class="n">yes</span>
</pre></div>
</div>
<p>so that you could then just connect using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">login</span><span class="o">.</span><span class="n">archer2</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span>
</pre></div>
</div>
</section>
</section>
<section id="set-up-your-archer2-environment">
<h2>Set up your ARCHER2 environment<a class="headerlink" href="#set-up-your-archer2-environment" title="Link to this heading"></a></h2>
<p>Login to ARCHER2 from your local desktop, copy the following profile to your home directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>archer2$ cp /work/y07/shared/umshared/um-training/rose-profile ~/.profile
</pre></div>
</div>
<p>Change the permissions on your <code class="docutils literal notranslate"><span class="pre">/home</span></code> and <code class="docutils literal notranslate"><span class="pre">/work</span></code> directories to enable the NCAS-CMS team to help with any queries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="n">g</span><span class="o">+</span><span class="n">rX</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">n02</span><span class="o">/</span><span class="n">n02</span><span class="o">/&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">username</span><span class="o">&gt;</span>
<span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="n">g</span><span class="o">+</span><span class="n">rX</span> <span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">n02</span><span class="o">/</span><span class="n">n02</span><span class="o">/&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">username</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="set-up-your-puma-environment">
<h2>Set up your PUMA environment<a class="headerlink" href="#set-up-your-puma-environment" title="Link to this heading"></a></h2>
<p>Login to PUMA from your local desktop.</p>
<section id="configure-profile">
<h3>Configure <code class="docutils literal notranslate"><span class="pre">~/.profile</span></code><a class="headerlink" href="#configure-profile" title="Link to this heading"></a></h3>
<p>If this is the first time you have used your PUMA account, you will need to create a <code class="docutils literal notranslate"><span class="pre">.profile</span></code>. Copy our standard one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>puma$ cd
puma$ cp ~um/um-training/setup/.profile .
</pre></div>
</div>
<p>(If you already have a <code class="docutils literal notranslate"><span class="pre">.profile</span></code>, make sure it includes the lines from the standard file.)</p>
</section>
<section id="configure-access-to-mosrs">
<h3>Configure access to MOSRS<a class="headerlink" href="#configure-access-to-mosrs" title="Link to this heading"></a></h3>
<p>Run the <code class="docutils literal notranslate"><span class="pre">mosrs-setup</span></code> script which will take you through the set up process to access the Met Office Science Repository Service (Remember your MOSRS username is one word; usually firstnamelastname, all in lowercase):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>puma$ ~um/um-training/mosrs-setup
</pre></div>
</div>
<p>Log out of PUMA and back in again (you will get a warning about not being able to find <code class="docutils literal notranslate"><span class="pre">~/.ssh/ssh-setup</span></code> this can be ignored and will be resolved in the next step). You should first be prompted for your <strong>Met Office Science Repository Service password</strong>.  Enter your password. Then you will be prompted for <strong>Username for ‘u’ - ‘https://code.metoffice.gov.uk/rosie/u’</strong> . Enter your MOSRS username.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The cached password is configured to expire after 12 hours. Simply run the command <code class="docutils literal notranslate"><span class="pre">mosrs-cache-password</span></code> to re-cache it if this happens. Also if you know you won’t need access to the repositories during a login session then just press return when asked for your MOSRS password.</p>
</div>
</section>
<section id="configure-connection-to-archer2">
<h3>Configure connection to ARCHER2<a class="headerlink" href="#configure-connection-to-archer2" title="Link to this heading"></a></h3>
<p>Due to ARCHER2 security and the UM workflow it is necessary to use a special ssh-key that allows submission of UM suite from PUMA.
Prior to the course you generated a UM workflow ssh-key called <code class="docutils literal notranslate"><span class="pre">~/.ssh/id_rsa_archerum</span></code>.</p>
<p><strong>i. Update ssh config file</strong></p>
<p>In your PUMA <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> file add the following section:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Host</span> <span class="n">login</span><span class="o">.</span><span class="n">archer2</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span>
<span class="n">User</span> <span class="o">&lt;</span><span class="n">archer2_username</span><span class="o">&gt;</span>
<span class="n">IdentityFile</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa_archerum</span>
<span class="n">ForwardX11</span> <span class="n">no</span>
<span class="n">ForwardX11Trusted</span> <span class="n">no</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;archer2_username&gt;</span></code> should be replaced with your ARCHER2 username. If you don’t have a <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> file create one.</p>
<p id="ssh-setup"><strong>ii. Set up ssh-agent</strong></p>
<p>Setting up an <code class="docutils literal notranslate"><span class="pre">ssh-agent</span></code> allows caching of your <code class="docutils literal notranslate"><span class="pre">id_rsa_archerum</span></code> key passphrase for a period of time.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>puma$ cp ~um/um-training/setup/ssh-setup ~/.ssh
</pre></div>
</div>
<p>Log out of PUMA and back in again to start up the <code class="docutils literal notranslate"><span class="pre">ssh-agent</span></code> process.</p>
<p>Add your <code class="docutils literal notranslate"><span class="pre">id_rsa_archerum</span></code> key to your <code class="docutils literal notranslate"><span class="pre">ssh-agent</span></code> by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>puma$ ssh-add ~/.ssh/id_rsa_archerum
Enter passphrase for /home/&lt;puma-username&gt;/.ssh/id_rsa:
[TYPE_YOUR_PASSPHRASE]
</pre></div>
</div>
<p>Enter your passphrase when prompted.  The <code class="docutils literal notranslate"><span class="pre">ssh-agent</span></code> will continue to run even when you log out of PUMA, however, it may stop from time to time, for example if PUMA is rebooted.  For instructions on what to do in this situation see <a class="reference internal" href="ssh-tasks.html#restarting-agent"><span class="std std-ref">Restarting your ssh agent</span></a> in the Appendix.</p>
<p><strong>iii. Verify the setup is correct</strong></p>
<p>Log in to ARCHER2 with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>puma$ ssh login.archer2.ac.uk
</pre></div>
</div>
<p>You should not be prompted for your passphrase.  The response from ARCHER2 should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>puma$ ssh login.archer2.ac.uk
PTY allocation request failed on channel 0
Comand rejected by policy. Not in authorised list
Connection to login.archer2.ac.uk closed.
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not possible to start an interactive login session on ARCHER2 from PUMA.  For an interactive session you need to login from your local desktop.</p>
</div>
<p>You are now ready to try running a UM suite!</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2023, NCAS-CMS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>