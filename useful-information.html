<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10. Appendix A: Useful information &mdash; NCAS Unified Model Introduction</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="11. Appendix B: SSH FAQs" href="ssh-tasks.html" />
    <link rel="prev" title="9. Post processing" href="post-processing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            NCAS Unified Model Introduction
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Practicals</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-setup-selfstudy.html">1. Getting Set Up (Self-Study Instructions)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working-with-suites.html">2. Working with Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">3. Running a UM suite on ARCHER2</a></li>
<li class="toctree-l1"><a class="reference internal" href="fcm-tutorial.html">4. FCM tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="solving-problems.html">5. Solving Common UM Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="further-exercises-1.html">6. Further Exercises (1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="further-exercises-2.html">7. Further Exercises (2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="rose-cylc-exercises.html">8. Rose/Cylc Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="post-processing.html">9. Post processing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">10. Appendix A: Useful information</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#um-output">10.1. UM output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#archer2-architecture">10.2. ARCHER2 architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="#archer2-file-systems">10.3. ARCHER2 file systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="#archer2-node-reservations">10.4. ARCHER2 node reservations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#useful-rose-commands">10.5. Useful Rose commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problems-shutting-down-suites">10.6. Problems shutting down suites</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ssh-tasks.html">11. Appendix B: SSH FAQs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NCAS Unified Model Introduction</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">10. </span>Appendix A: Useful information</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/useful-information.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="appendix-a-useful-information">
<h1><span class="section-number">10. </span>Appendix A: Useful information<a class="headerlink" href="#appendix-a-useful-information" title="Link to this heading"></a></h1>
<section id="um-output">
<h2><span class="section-number">10.1. </span>UM output<a class="headerlink" href="#um-output" title="Link to this heading"></a></h2>
<p><strong>ARCHER2 job output directory:</strong></p>
<p>The standard output and error files (job.out &amp; job.err) for the compile, reconfiguration and run are written to the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">run</span><span class="o">/&lt;</span><span class="n">suite</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;/</span><span class="n">log</span><span class="o">/</span><span class="n">job</span><span class="o">/&lt;</span><span class="n">cycle</span><span class="o">&gt;/&lt;</span><span class="n">app</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><strong>ARCHER2 model output:</strong></p>
<p>By default the UM will write all output (e.g. processor output and data files) to the directory it was launched from, which will be the task’s <strong>work</strong> directory. However, all output paths can be configured in the GUI and in practice most UM tasks will send output to one or both of the suite’s <strong>work</strong> or <strong>share</strong> directories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">run</span><span class="o">/&lt;</span><span class="n">suitename</span><span class="o">&gt;/</span><span class="n">work</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="n">atmos</span>
<span class="o">~/</span><span class="n">cylc</span><span class="o">-</span><span class="n">run</span><span class="o">/&lt;</span><span class="n">suitename</span><span class="o">&gt;/</span><span class="n">share</span><span class="o">/</span><span class="n">data</span>
</pre></div>
</div>
</section>
<section id="archer2-architecture">
<h2><span class="section-number">10.2. </span>ARCHER2 architecture<a class="headerlink" href="#archer2-architecture" title="Link to this heading"></a></h2>
<p>ARCHER2 has two kinds of processor which we commonly use - they have several names, but roughly speaking they are the service processors (several nodes worth) sometimes referred to as the front end, and the compute processors (many many nodes worth) sometimes referred to as the back end. We login to the front end and build the model on the front end. We run the model on the back end. You wouldn’t generally have an interactive session on the back end and will submit jobs there through the batch scheduler (slurm).</p>
<p>The UM infrastructure recognises this architecture and will run tasks in the appropriate place.</p>
<p>If you are doing any post-processing or analysis you may wish to submit your own parallel or serial jobs. Intensive interactive tasks should be run on the post-processor nodes (note. these will be available when the full system is in service.)</p>
<p>Consult the ARCHER2 documentation for details (See www.archer2.ac.uk).</p>
</section>
<section id="archer2-file-systems">
<h2><span class="section-number">10.3. </span>ARCHER2 file systems<a class="headerlink" href="#archer2-file-systems" title="Link to this heading"></a></h2>
<p>ARCHER2, in common with some other HPC systems, such as MONSooN, has (at least) two file systems which have different properties, different uses, different associated policies and different names. On ARCHER2 there are <code class="docutils literal notranslate"><span class="pre">/home</span></code> and <code class="docutils literal notranslate"><span class="pre">/work</span></code>. The <code class="docutils literal notranslate"><span class="pre">/home</span></code> file system is backed up regularly (only for disaster recovery), has relatively small volume, can efficiently handle many small files, and is where we recommend the UM code is saved and built. The <code class="docutils literal notranslate"><span class="pre">/home</span></code> system can not be accessed by jobs running on the compute processors.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">/work</span></code> file system is optimized for fast parallel IO - it doesn’t handle small files very efficiently. It is where your model will write to and read from.</p>
</section>
<section id="archer2-node-reservations">
<h2><span class="section-number">10.4. </span>ARCHER2 node reservations<a class="headerlink" href="#archer2-node-reservations" title="Link to this heading"></a></h2>
<p>In normal practice you will submit your jobs to the parallel queue on ARCHER2; the job scheduler will then manage your job request along with all those from the thousands of other users. For this training course, we will be using processor Reservations, whereby we have exclusive access to a prearranged amount of ARCHER2 resource meaning that you will not need to wait in the general ARCHER2 queues. Reservations are specified by a reservation code - e.g. n02-training_266. As an ARCHER2 user you can make a reservation so that you have access to the machine at a time of your choosing - reservations incur a cost overhead (50%), so best used when you are sure you need them.</p>
</section>
<section id="useful-rose-commands">
<h2><span class="section-number">10.5. </span>Useful Rose commands<a class="headerlink" href="#useful-rose-commands" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span></code></p>
<blockquote>
<div><p>Run a suite.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span> <span class="pre">--new</span></code></p>
<blockquote>
<div><p>Clear out any existing cylc-run directories for this suite and then run it.  Take care when using this option as it deletes all files from any previous runs of the suite.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span> <span class="pre">--no-log-archive</span></code></p>
<blockquote>
<div><p>Do not archive (tar-gzip) old log directories.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span> <span class="pre">--restart</span></code></p>
<blockquote>
<div><p>Restart the suite from where it finished running previously</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span> <span class="pre">[--restart]</span> <span class="pre">--</span> <span class="pre">--hold</span></code></p>
<blockquote>
<div><p>Hold (don’t run tasks) immediately on running or restarting the suite</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-shutdown</span></code></p>
<blockquote>
<div><p>Shutdown (stop) a running suite.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">sgc</span></code></p>
<blockquote>
<div><p>Launch the Cylc GUI for a running suite.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-scan</span></code></p>
<blockquote>
<div><p>Scan for any running suites.  This is useful when you’ve shutdown the cylc GUIs and wish to quickly see what suites you still have running.</p>
</div></blockquote>
<p>For more information on all these commands and more see the Rose and Cylc documentation or run <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">command</span> <span class="pre">--help</span></code> (E.g. <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">suite-run</span> <span class="pre">--help</span></code>) to view the man pages.</p>
</section>
<section id="problems-shutting-down-suites">
<h2><span class="section-number">10.6. </span>Problems shutting down suites<a class="headerlink" href="#problems-shutting-down-suites" title="Link to this heading"></a></h2>
<p><strong>Types of shutdown</strong></p>
<p>By default when you try to shutdown a suite, cylc will wait for any currently running tasks to finish before stopping, which may not be what you want to do. You can also tell cylc to kill any active processes or ignore running processes and force the suite to shutdown anyway. The latter is what you will need to do if the suite has got stuck:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">suite</span><span class="o">-</span><span class="n">shutdown</span> <span class="o">--</span> <span class="o">--</span><span class="n">now</span>
</pre></div>
</div>
<p>To access these options in the cylc GUI, go to <em>“Control” -&gt; “Stop Suite”</em>. See also <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">help</span> <span class="pre">suite-shutdown</span></code> for further details.</p>
<p><strong>Forcing shutdown</strong></p>
<p>Sometimes after trying to shutdown a suite, it will still appear to be running.</p>
<p>First make sure you have used the correct shutdown command and aren’t waiting for any unfinished tasks (see above). It can take cylc a little while to shut down everything properly, so be patient and give it a few minutes.</p>
<p>If it still appears to be running (for example you get an error when you try to re-start the suite), you may have to do the following:</p>
<ul>
<li><p>Manually kill the active processes:</p>
<p>Get a list of processes associated with the suite. For example, for suite u-cn134 you would run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>puma$ ps -flu ros | grep u-cn134
1 S ros   15688     1  ... python2 /home/fcm/cylc-7.8.12/bin/cylc-restart u-cn134
0 S ros   15707     1  ... python2 /home/fcm/cylc-7.8.12/bin/cylc-gui u-cn134
0 S ros   16305 24946  ... grep --color=auto u-cn134
</pre></div>
</div>
<p>This gives a list of processes. The number in the 4th column is the process-id. Use this to kill each of the processes, eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kill</span> <span class="o">-</span><span class="mi">9</span> <span class="mi">15688</span>
</pre></div>
</div>
</li>
<li><p>Try restarting the suite.</p></li>
<li><p>If that still doesn’t work you may also need to delete the contact file:</p>
<p>This lives in <code class="docutils literal notranslate"><span class="pre">~/cylc-run/&lt;suiteid&gt;/.service</span></code> directory. For example: <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">~/cylc-run/u-cn134/.service/contact</span></code></p>
</li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="post-processing.html" class="btn btn-neutral float-left" title="9. Post processing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ssh-tasks.html" class="btn btn-neutral float-right" title="11. Appendix B: SSH FAQs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2023, NCAS-CMS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>