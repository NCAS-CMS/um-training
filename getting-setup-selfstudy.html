<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Getting Set Up (Self-Study Instructions) &mdash; NCAS Unified Model Introduction</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            NCAS Unified Model Introduction
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Practicals</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Getting Set Up (Self-Study Instructions)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working-with-suites.html">2. Working with Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">3. Running a UM suite on ARCHER2</a></li>
<li class="toctree-l1"><a class="reference internal" href="fcm-tutorial.html">4. FCM tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="solving-problems.html">5. Solving Common UM Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="further-exercises-1.html">6. Further Exercises (1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="further-exercises-2.html">7. Further Exercises (2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="rose-cylc-exercises.html">8. Rose/Cylc Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="post-processing.html">9. Post processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="useful-information.html">10. Appendix A: Useful information</a></li>
<li class="toctree-l1"><a class="reference internal" href="ssh-tasks.html">11. Appendix B: SSH FAQs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NCAS Unified Model Introduction</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">1. </span>Getting Set Up (Self-Study Instructions)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/getting-setup-selfstudy.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="getting-set-up-self-study-instructions">
<h1><span class="section-number">1. </span>Getting Set Up (Self-Study Instructions)<a class="headerlink" href="#getting-set-up-self-study-instructions" title="Link to this heading"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You <strong>MUST</strong> have PUMA2, ARCHER2 and MOSRS accounts setup before starting this section.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you have moved your account over to PUMA2 from the old PUMA server (pumanew), then you should follow these instructions: <a class="reference external" href="https://cms.ncas.ac.uk/puma2/">https://cms.ncas.ac.uk/puma2/</a></p>
</div>
<section id="set-up-your-archer2-connection">
<span id="archer2"></span><h2><span class="section-number">1.1. </span>Set up your ARCHER2 connection<a class="headerlink" href="#set-up-your-archer2-connection" title="Link to this heading"></a></h2>
<p>To use the UM Introduction Tutorials you will first need to ensure you can connect from your local desktop to ARCHER2.  There a multiple ways in which you can do this depending on your desktop platform:</p>
<ul class="simple">
<li><p>via <a class="reference internal" href="#terminal">Terminal</a> on GNU/Linux &amp; macOS</p></li>
<li><p>via <a class="reference internal" href="#mobaxterm">MobaXTerm</a> on Windows</p></li>
</ul>
<section id="ssh-key-files">
<h3>SSH key files<a class="headerlink" href="#ssh-key-files" title="Link to this heading"></a></h3>
<p>Before you try and connect to ARCHER2, you need to make sure that you have the ssh-keys available on your computer.
In these instructions, we’ve assumed the keys are called <code class="docutils literal notranslate"><span class="pre">id_rsa_archer2</span></code> and <code class="docutils literal notranslate"><span class="pre">id_rsa_archer2.pub</span></code>. Replace with the name of your keys as appropriate.</p>
</section>
<section id="connecting-via-a-terminal-gnu-linux-macos">
<span id="terminal"></span><h3>Connecting via a Terminal (GNU/Linux &amp; macOS)<a class="headerlink" href="#connecting-via-a-terminal-gnu-linux-macos" title="Link to this heading"></a></h3>
<p>It is possible to connect via a terminal with an X11 connection (<a class="reference external" href="https://www.xquartz.org/">XQuartz</a> is also required when using macOS)</p>
<p>Login to ARCHER2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">-</span><span class="n">Y</span> <span class="o">-</span><span class="n">i</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa_archer2</span> <span class="o">&lt;</span><span class="n">archer2</span><span class="o">-</span><span class="n">username</span><span class="o">&gt;</span><span class="nd">@login</span><span class="o">.</span><span class="n">archer2</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span>
</pre></div>
</div>
<p>To simplify the login process, you can define a <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> file entry containing the necessary information. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Host</span> <span class="n">archer2</span>
<span class="n">Hostname</span> <span class="n">login</span><span class="o">.</span><span class="n">archer2</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span>
<span class="n">User</span> <span class="o">&lt;</span><span class="n">archer2_username</span><span class="o">&gt;</span>
<span class="n">IdentityFile</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa_archer2</span>
<span class="n">ForwardX11</span> <span class="n">yes</span>
<span class="n">ForwardX11Trusted</span> <span class="n">yes</span>
</pre></div>
</div>
<p>so that you can connect using just the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">archer2</span>
</pre></div>
</div>
</section>
<section id="connecting-via-mobaxterm">
<span id="mobaxterm"></span><h3>Connecting via MobaXTerm<a class="headerlink" href="#connecting-via-mobaxterm" title="Link to this heading"></a></h3>
<ul>
<li><p>From Chrome, go to page: <a class="reference external" href="https://mobaxterm.mobatek.net/download.html">https://mobaxterm.mobatek.net/download.html</a></p></li>
<li><p>Under “Home Edition” select “Download now”</p></li>
<li><div class="line-block">
<div class="line">On next page select <strong>“MobaXterm Home Edition v23.4 (Portable edition)”</strong>.</div>
<div class="line">This should download the package.</div>
</div>
</li>
<li><p>Click the download icon in the bottom left hand corner.</p></li>
<li><div class="line-block">
<div class="line">Double-click on the <strong>MobaXterm_Personal_23.4</strong> application file, and select “Extract all”.</div>
<div class="line">A new directory window will open up.</div>
</div>
</li>
<li><p>Double-click <strong>MobaXterm_Personal_23.4</strong> to launch the application.</p></li>
</ul>
<p>Next time, navigate to “Downloads” to open the application.</p>
</section>
</section>
<section id="set-up-your-archer2-environment">
<h2><span class="section-number">1.2. </span>Set up your ARCHER2 environment<a class="headerlink" href="#set-up-your-archer2-environment" title="Link to this heading"></a></h2>
<p>Login to ARCHER2 from your local desktop, copy the following profile to your home directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>archer2$ cp /work/y07/shared/umshared/um-training/rose-profile ~/.profile
</pre></div>
</div>
<p>Change the permissions on your <code class="docutils literal notranslate"><span class="pre">/home</span></code> and <code class="docutils literal notranslate"><span class="pre">/work</span></code> directories to enable the NCAS-CMS team to help with any queries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="n">g</span><span class="o">+</span><span class="n">rX</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">n02</span><span class="o">/</span><span class="n">n02</span><span class="o">/&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">username</span><span class="o">&gt;</span>
<span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="n">g</span><span class="o">+</span><span class="n">rX</span> <span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">n02</span><span class="o">/</span><span class="n">n02</span><span class="o">/&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">username</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="set-up-your-puma2-connection">
<span id="puma2"></span><h2><span class="section-number">1.3. </span>Set up your PUMA2 connection<a class="headerlink" href="#set-up-your-puma2-connection" title="Link to this heading"></a></h2>
<p>PUMA2 is accessed from the ARCHER2 login nodes, and you will use the same username and password.</p>
<p>From an ARCHER2 terminal type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>archer2$ ssh -Y puma2
</pre></div>
</div>
<p>and type your ARCHER2 password when prompted.</p>
<p>You should now be logged into PUMA2. To go back to the ARCHER2 login nodes, type <code class="docutils literal notranslate"><span class="pre">exit</span></code>.</p>
<section id="set-up-passwordless-access-to-puma2">
<h3>Set up passwordless access to PUMA2<a class="headerlink" href="#set-up-passwordless-access-to-puma2" title="Link to this heading"></a></h3>
<p>You can set up a passphrase-less ssh-key to allow you to connect to PUMA2 without typing a password or passphrase.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We would never normally advise using an ssh-key without a passphrase, but in this case it is safe to do so since we are already authenticated within the ARCHER2 system.</p>
</div>
<p>From the ARCHER2 login nodes, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>archer2$ ssh-keygen -t rsa -f ~/.ssh/id_rsa_puma2
</pre></div>
</div>
<p>At the prompt, press enter for an empty passphrase.</p>
<p>Copy the key over to PUMA2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>archer2$ ssh-copy-id -i ~/.ssh/id_rsa_puma2 puma2
</pre></div>
</div>
<p>Type in your ARCHER2 password when prompted.</p>
<p>Next, create a file called <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> (if it doesn’t already exist), and add the following lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Host</span> <span class="n">puma2</span>
<span class="n">IdentityFile</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa_puma2</span>
<span class="n">ForwardX11</span> <span class="n">yes</span>
</pre></div>
</div>
<p>Test it works by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>archer2$ ssh puma2
</pre></div>
</div>
<p>You should not be prompted for your password. Note that this should have set up X11 forwarding, so you no longer need the <code class="docutils literal notranslate"><span class="pre">-Y</span></code> option.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You should never use a passphrase-less key to access the ARCHER2 login nodes, as this is a serious security risk.</p>
</div>
</section>
</section>
<section id="set-up-your-puma2-environment">
<h2><span class="section-number">1.4. </span>Set up your PUMA2 environment<a class="headerlink" href="#set-up-your-puma2-environment" title="Link to this heading"></a></h2>
<p>Copy our standard <code class="docutils literal notranslate"><span class="pre">.profile</span></code> and <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>puma2$ cd
puma2$ cp ~um1/um-training/puma2/.bash_profile .
puma2$ cp ~um1/um-training/puma2/.bashrc .
</pre></div>
</div>
<p>Logout of PUMA2 and back in again to pick up these changes.</p>
<p>You will get a warning about not being able to find <code class="docutils literal notranslate"><span class="pre">~/.ssh/ssh-setup</span></code>.  This can be ignored and will be resolved in the next step.</p>
<p>You should also be prompted for your Met Office Science Repository Service password, then username. Note that it asks for your <strong>password</strong> first. Remember your MOSRS username is one word; usually firstnamelastname, all in lowercase.</p>
<p>If the password caching works, you should see:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Subversion</span> <span class="n">password</span> <span class="n">cached</span>
<span class="n">Rosie</span> <span class="n">password</span> <span class="n">cached</span>
</pre></div>
</div>
<p>This means you can now access the code and roses suites stored in the Met Office respositories.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The cached password is configured to expire after 12 hours. Simply run the command <code class="docutils literal notranslate"><span class="pre">mosrs-cache-password</span></code> to re-cache it if this happens. Also if you know you won’t need access to the repositories during a login session then just press return when asked for your MOSRS password.</p>
</div>
<p>Finally, change the permission on your PUMA2 <code class="docutils literal notranslate"><span class="pre">/home</span></code> space:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="n">g</span><span class="o">+</span><span class="n">rX</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">n02</span><span class="o">/</span><span class="n">n02</span><span class="o">/&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">username</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="set-up-your-ssh-agent">
<span id="ssh-setup"></span><h2><span class="section-number">1.5. </span>Set up your ssh-agent<a class="headerlink" href="#set-up-your-ssh-agent" title="Link to this heading"></a></h2>
<p>In order to submit jobs to ARCHER2 from PUMA2, you will need to set up an <code class="docutils literal notranslate"><span class="pre">ssh-agent</span></code> and use it to cache the passphrase to your ARCHER2 key.</p>
<p><strong>i. Copy your ARCHER2 ssh-key pair to PUMA2</strong></p>
<p>Your ARCHER2 key is the one that you use to ssh into the ARCHER2 login nodes.  You need to copy both the public and private keys into your <code class="docutils literal notranslate"><span class="pre">.ssh/</span></code> directory on PUMA2.</p>
<p>Open a new terminal from wherever you originally connected to ARCHER2 in <a class="reference internal" href="#archer2"><span class="std std-ref">Set up your ARCHER2 connection</span></a>, and run the following command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa_archer2</span><span class="o">*</span> <span class="o">&lt;</span><span class="n">archer2</span><span class="o">-</span><span class="n">username</span><span class="o">&gt;</span><span class="nd">@login</span><span class="o">.</span><span class="n">archer2</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">n02</span><span class="o">/</span><span class="n">n02</span><span class="o">-</span><span class="n">puma</span><span class="o">/&lt;</span><span class="n">archer2</span><span class="o">-</span><span class="n">username</span><span class="o">&gt;/.</span><span class="n">ssh</span>
</pre></div>
</div>
<p><strong>ii. Start up your ssh-agent</strong></p>
<p>First copy the <code class="docutils literal notranslate"><span class="pre">ssh-setup</span></code> script to your <code class="docutils literal notranslate"><span class="pre">.ssh/</span></code> directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>puma2$ cp ~um1/um-training/setup/ssh-setup ~/.ssh
</pre></div>
</div>
<p>Next log out of PUMA2 and back in again to start up the <code class="docutils literal notranslate"><span class="pre">ssh-agent</span></code> process. You should see the following message</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Initialising</span> <span class="n">new</span> <span class="n">SSH</span> <span class="n">agent</span><span class="o">...</span>
</pre></div>
</div>
<p><strong>iii. Add your ARCHER2 key</strong></p>
<p>Add your ARCHER2 key to the <code class="docutils literal notranslate"><span class="pre">ssh-agent</span></code>, by running</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>puma2$ ssh-add ~/.ssh/id_rsa_archer2
</pre></div>
</div>
<p>Enter your passphrase when prompted. If the passphrase has been cached successfully you should see a message like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Identity</span> <span class="n">added</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">n02</span><span class="o">/</span><span class="n">n02</span><span class="o">/&lt;</span><span class="n">archer2</span><span class="o">-</span><span class="n">username</span><span class="o">&gt;/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa_archer2</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ssh-agent</span></code> will continue to run even when you log out of PUMA2. However, it may stop from time to time, for example if PUMA2 is rebooted.  For instructions on what to do in this situation see <a class="reference internal" href="ssh-tasks.html#restarting-agent"><span class="std std-ref">Restarting your ssh agent</span></a> in the Appendix.</p>
<p><strong>iv. Configure access to the ARCHER2 login nodes</strong></p>
<p>Create a file <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> (if it doesn’t already exist), and add the following lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ARCHER2 login nodes</span>
<span class="n">Host</span> <span class="n">ln</span><span class="o">*</span>
<span class="n">IdentityFile</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa_archer2</span>
</pre></div>
</div>
<p><strong>iv. Verify the setup is correct</strong></p>
<p>To test this is all working correctly, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>puma2$ rose host-select archer2
</pre></div>
</div>
<p>This should return one of the login nodes, e.g. <code class="docutils literal notranslate"><span class="pre">ln01</span></code>. If it returns a message like <code class="docutils literal notranslate"><span class="pre">[WARN]</span> <span class="pre">ln03:</span> <span class="pre">(ssh</span> <span class="pre">failed)</span></code> then something has gone wrong with the ssh setup.</p>
<p>You are now ready to try running a UM suite!</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2023, NCAS-CMS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>