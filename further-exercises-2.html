

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>7. Further Exercises (2) &mdash; NCAS Unified Model Introduction</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="8. Rose/Cylc Exercises" href="rose-cylc-exercises.html" />
    <link rel="prev" title="6. Further Exercises (1)" href="further-exercises-1.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> NCAS Unified Model Introduction
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Practicals</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-setup.html">1. Getting set up</a></li>
<li class="toctree-l1"><a class="reference internal" href="working-with-suites.html">2. Working with Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">3. Running a UM suite on ARCHER2</a></li>
<li class="toctree-l1"><a class="reference internal" href="fcm-tutorial.html">4. FCM tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="solving-problems.html">5. Solving Common UM Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="further-exercises-1.html">6. Further Exercises (1)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7. Further Exercises (2)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#post-processing-archive-and-transfer-of-model-data">7.1. Post-Processing (archive and transfer of model data)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-io-servers">7.2. Using IO Servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-netcdf-output-from-the-um">7.3. Writing NetCDF output from the UM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enable-netcdf">Enable NetCDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-netcdf-output-streams">Set NetCDF Output Streams</a></li>
<li class="toctree-l3"><a class="reference internal" href="#direct-output-to-the-nc-streams">Direct output to the nc streams</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-coupled-model">7.4. Running the coupled model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#checkout-and-run-the-suite">Checkout and run the suite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exploring-the-suite">Exploring the suite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-files">Output files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-nesting-suite">7.5. Running the Nesting Suite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Checkout and run the suite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Exploring the Suite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initial-data">Initial Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-ancillary-files">The ancillary files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-output-files">The output files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#further-information">Further Information</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rose-cylc-exercises.html">8. Rose/Cylc Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="post-processing.html">9. Post processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="useful-information.html">10. Appendix A: Useful information</a></li>
<li class="toctree-l1"><a class="reference internal" href="ssh-tasks.html">11. Appendix B: SSH FAQs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NCAS Unified Model Introduction</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">7. </span>Further Exercises (2)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/further-exercises-2.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="further-exercises-2">
<h1><span class="section-number">7. </span>Further Exercises (2)<a class="headerlink" href="#further-exercises-2" title="Permalink to this headline">¶</a></h1>
<p>The exercises in this section are all optional.  We suggest you pick and choose the exercises that you feel are most relevant to the work you are/will be doing.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use your copy of suite <code class="docutils literal notranslate"><span class="pre">u-cc654</span></code> for these exercises unless otherwise specified.</p>
</div>
<div class="section" id="post-processing-archive-and-transfer-of-model-data">
<h2><span class="section-number">7.1. </span>Post-Processing (archive and transfer of model data)<a class="headerlink" href="#post-processing-archive-and-transfer-of-model-data" title="Permalink to this headline">¶</a></h2>
<p>When your model runs it outputs data onto the ARCHER2 <code class="docutils literal notranslate"><span class="pre">/work</span></code> disk (<code class="docutils literal notranslate"><span class="pre">/projects</span></code> on Monsoon2). If you are running a long integration and/or at high resolution data will mount up very quickly and you will need to move the data off of ARCHER2; for example to JASMIN.  The post-processing app (postproc) is used within cycling suites to automatically <em>archive</em>  model data and can be optionally configured to transfer the data from ARCHER2 to the JASMIN data facility.  The app archives and deletes model output files, not only for the UM, but also NEMO and CICE in coupled configurations.</p>
<p>Let’s try configuring your suite to archive to a staging location on ARCHER2:</p>
<ul class="simple">
<li><p>Switch on post-processsing in window <span class="guilabel">suite conf –&gt; Tasks</span></p></li>
</ul>
<p>The post-processing is configured under the <span class="guilabel">postproc</span> section:</p>
<ul class="simple">
<li><p>Select the <span class="guilabel">Archer</span> archiving system in window <span class="guilabel">Post Processing - common settings</span>.</p></li>
</ul>
<p>A couple of new entries will have appeared in the index panel, <span class="guilabel">Archer Archiving</span> and <span class="guilabel">JASMIN Transfer</span>, identified with the blue dots.</p>
<p>You now need to specify where you want your archived data to be copied to:</p>
<ul class="simple">
<li><p>In the <span class="guilabel">Archer Archiving</span> panel set <code class="docutils literal notranslate"><span class="pre">archive_root_dir</span></code> to be <code class="docutils literal notranslate"><span class="pre">/work/n02/n02/&lt;userid&gt;/archive</span></code>.  The <code class="docutils literal notranslate"><span class="pre">archive_name</span></code> (suite id) will be automatically appended to this.</p></li>
</ul>
<p>You will need to run the model for at least 1 day as archiving doesn’t work for periods of less than 1 day.  Change the <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">length</span></code> and <code class="docutils literal notranslate"><span class="pre">cycling</span> <span class="pre">frequency</span></code> to be 1 day.  This should complete in about 5 minutes so set the <code class="docutils literal notranslate"><span class="pre">wallclock</span> <span class="pre">time</span></code> to be 10 minutes.</p>
<p><span class="guilabel">Run</span> the suite.</p>
<p>Once the run has completed go to the archive directory for this cycle (e.g. <code class="docutils literal notranslate"><span class="pre">/nerc/n02/n02/&lt;userid&gt;/&lt;suiteid&gt;/19880901T0000Z</span></code>) and you should see several files have been copied over (e.g <code class="docutils literal notranslate"><span class="pre">cc654a.pc19880901_00.pp</span></code>).</p>
<p>Data files that have been archived and are no longer required by the model for restarting or for calculating means (seasonal, annual, etc) are deleted from the suite <code class="docutils literal notranslate"><span class="pre">History_Data</span></code> directory. Go to the <code class="docutils literal notranslate"><span class="pre">History_Data</span></code> directory for your suite and confirm that this has happened. This run is reinitialising the <code class="docutils literal notranslate"><span class="pre">pc</span></code> data stream every 6 hours and you should see that it has only removed data files for this stream up to 18:00hrs, the <code class="docutils literal notranslate"><span class="pre">cc654a.pc19880901_18.pp</span></code> file is still present.  This file contains data for the hours 18-24 and would be required by the model in order to restart. Equally seasonal mean files would not be fully archived until the end of the year, after the annual mean has been created.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The post-processing app can also be configured to transfer the archived data over to JASMIN.  Details on how to do this are available on the CMS website: <a class="reference external" href="http://cms.ncas.ac.uk/wiki/Docs/PostProcessingApp">http://cms.ncas.ac.uk/wiki/Docs/PostProcessingApp</a></p>
</div>
</div>
<div class="section" id="using-io-servers">
<h2><span class="section-number">7.2. </span>Using IO Servers<a class="headerlink" href="#using-io-servers" title="Permalink to this headline">¶</a></h2>
<p>Older versions of the UM did not have IO servers, which meant that all reading and writing of fields files went through a single processor (pe0).  When the model is producing lots of data and is running on many processors, this method of IO is very inefficient and costly - when pe0 is writing data, all the other processors have to wait around doing nothing but still consuming AUs.  Later UM versions, including UM 10.5, have IO servers which are processors dedicated to performing IO and which work asynchronously with processors doing the computation.</p>
<p>Here’s just a taste of how to get this working in your suite.</p>
<p>Set the suite to run for 1 day with an appropriate cycling frequency, then check that <code class="docutils literal notranslate"><span class="pre">OpenMP</span></code> is switched on as this is needed for the IO servers to work.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Search for <code class="docutils literal notranslate"><span class="pre">openmp</span></code> in the rose edit GUI</p>
</div>
<p>Navigate to <span class="guilabel">suite conf –&gt; Domain Decomposition –&gt; Atmosphere</span> and check the number of <code class="docutils literal notranslate"><span class="pre">OpenMP</span> <span class="pre">threads</span></code> is set to <code class="docutils literal notranslate"><span class="pre">2</span></code>. Set the number of <code class="docutils literal notranslate"><span class="pre">IO</span> <span class="pre">Server</span> <span class="pre">Processes</span></code> to <code class="docutils literal notranslate"><span class="pre">8</span></code>.</p>
<p><span class="guilabel">Save</span> and then <span class="guilabel">Run</span> the suite.</p>
<p>You will see lots of IO server log files in <code class="docutils literal notranslate"><span class="pre">~/cylc-run/&lt;suitename&gt;/work/&lt;cycle&gt;/atmos_main</span></code> which can be ignored for the most part.</p>
<p>Try repeating the <a class="reference internal" href="further-exercises-1.html#change-dump-freq"><span class="std std-ref">Change the dump frequency</span></a> experiment with the IO servers switched on - you should see much faster performance.</p>
</div>
<div class="section" id="writing-netcdf-output-from-the-um">
<h2><span class="section-number">7.3. </span>Writing NetCDF output from the UM<a class="headerlink" href="#writing-netcdf-output-from-the-um" title="Permalink to this headline">¶</a></h2>
<p>Until UM vn10.9, only fields-file output was available from the UM - bespoke NetCDF output configurations did exist but not on the UM trunk. The suite used in most of these Section 7 exercises is vn11.7, hence supports both fields-file and NetCDF output data formats.</p>
<div class="section" id="enable-netcdf">
<h3>Enable NetCDF<a class="headerlink" href="#enable-netcdf" title="Permalink to this headline">¶</a></h3>
<p>Make sure that <code class="docutils literal notranslate"><span class="pre">IO</span> <span class="pre">Server</span> <span class="pre">Processes</span></code> variable is set to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>Navigate to <span class="guilabel">um –&gt; namelist –&gt; Model Input and Output –&gt; NetCDF Output Options</span> and set <code class="docutils literal notranslate"><span class="pre">l_netcdf</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code>. Several fields will appear which allow you to configure various NetCDF options.  For this exercise, leave them at their chosen values.</p>
</div>
<div class="section" id="set-netcdf-output-streams">
<h3>Set NetCDF Output Streams<a class="headerlink" href="#set-netcdf-output-streams" title="Permalink to this headline">¶</a></h3>
<p>Expand the <span class="guilabel">NetCDF Output Streams</span> section. A single stream - <code class="docutils literal notranslate"><span class="pre">nc0</span></code> - already exists; select it to display its content. As a useful comaprison, expand the <span class="guilabel">Model Output Streams</span> section and with the middle mouse button select <span class="guilabel">pp0</span>. Observe that the only significant differences between <code class="docutils literal notranslate"><span class="pre">pp0</span></code> and <code class="docutils literal notranslate"><span class="pre">nc0</span></code> are the values of <code class="docutils literal notranslate"><span class="pre">file_id</span></code> and <code class="docutils literal notranslate"><span class="pre">filename_base</span></code>.  Data compression options for <code class="docutils literal notranslate"><span class="pre">nc0</span></code> are revealed if <code class="docutils literal notranslate"><span class="pre">l_compress</span></code> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>. NetCDF deflation is a computationally expensive process best handled asynchronously to computation and as yet not fully implemented through the UM IO Server scheme (but under active development.) For many low- to medium-resolution models and, depending precisely on output profiles, high-resolution models also, use of UM-NetCDF without IO servers still provides significant benefits over fields-file output since using it avoids the need for subsequent file format conversion.</p>
<p>Right-click on <span class="guilabel">nc0</span> and select <span class="guilabel">Clone this section</span>. Edit the settings of the newly cloned section appropriately to make the new stream similar to <code class="docutils literal notranslate"><span class="pre">pp1</span></code> (ie. edit <code class="docutils literal notranslate"><span class="pre">filename_base</span></code> and all the reinitialisation variables). It is sensible to change the name of the new stream from <code class="docutils literal notranslate"><span class="pre">1</span></code> to something more meaningful, <code class="docutils literal notranslate"><span class="pre">nc1</span></code> for example (right click on <code class="docutils literal notranslate"><span class="pre">1</span></code>, select <span class="guilabel">Rename a section</span>, and change …nc(1) to …nc (nc1)).</p>
</div>
<div class="section" id="direct-output-to-the-nc-streams">
<h3>Direct output to the nc streams<a class="headerlink" href="#direct-output-to-the-nc-streams" title="Permalink to this headline">¶</a></h3>
<p>Expand <span class="guilabel">STASH Requests and Profiles</span>, then expand <span class="guilabel">Usage Profiles</span>. Assign nc streams to usage profiles - in this suite, UPA and UPB are assigned to <code class="docutils literal notranslate"><span class="pre">pp0</span></code> and <code class="docutils literal notranslate"><span class="pre">pp1</span></code> respectively (where can you see this?). Edit these Usage profiles to refer to <code class="docutils literal notranslate"><span class="pre">nc0</span></code> and <code class="docutils literal notranslate"><span class="pre">nc1</span></code> respectively. Run the STASH Macros (if you need a reminder see Section 6), save the changes, and run the suite. Check that the NetCDF output is what you expected.</p>
<p>Try adding more nc streams to mimic the pp stream behaviour.</p>
</div>
</div>
<div class="section" id="running-the-coupled-model">
<h2><span class="section-number">7.4. </span>Running the coupled model<a class="headerlink" href="#running-the-coupled-model" title="Permalink to this headline">¶</a></h2>
<p>The coupled model consists of the UM Atmosphere model coupled to the NEMO ocean and CICE sea ice models.  The coupled configuration used for this exercise is the UKESM Historical configuration with an N96 resolution for the atmosphere and a 1 degree ocean - you will see this written N96 ORCA1.</p>
<div class="section" id="checkout-and-run-the-suite">
<h3>Checkout and run the suite<a class="headerlink" href="#checkout-and-run-the-suite" title="Permalink to this headline">¶</a></h3>
<p>Checkout and open the suite <code class="docutils literal notranslate"><span class="pre">u-ce119</span></code>.  The first difference you should see is in the naming of the apps; there is a separate build app for the um and ocean, called <code class="docutils literal notranslate"><span class="pre">fcm_make_um</span></code> and <code class="docutils literal notranslate"><span class="pre">fcm_make_ocean</span></code> respectively. Similarly there are separate apps for the atmos and ocean model settings, called <code class="docutils literal notranslate"><span class="pre">um</span></code> and <code class="docutils literal notranslate"><span class="pre">nemo_cice</span></code>.</p>
<p>Make the usual changes required to run the suite (i.e. set username, account code, queue). If you are following the tutorial as part of an organised training event, select one of the special queues, otherwise, select to run in the <code class="docutils literal notranslate"><span class="pre">short</span></code> queue.</p>
<p>Check that the suite is set to build the UM, Ocean, and Drivers as well as run the reconfiguration and model.</p>
<p><span class="guilabel">Run</span> the suite.</p>
</div>
<div class="section" id="exploring-the-suite">
<h3>Exploring the suite<a class="headerlink" href="#exploring-the-suite" title="Permalink to this headline">¶</a></h3>
<p>Whilst the suite is compiling and running which will take around 40 minutes, take some time to look around the suite.</p>
<ul class="simple">
<li><p>How many nodes is the atmosphere running on?</p></li>
<li><p>How many nodes is the ocean running on?</p></li>
<li><p>What is the cycling frequency?</p></li>
</ul>
<p>The version of NEMO used in this suite (and most suites you will come across) uses the XML IO Server (XIOS) to wite its diagnostic output. XIOS runs on dedicated nodes (one node in this case). Running <code class="docutils literal notranslate"><span class="pre">squeue</span></code> will show three status entries corresponding to the Atmosphere, Ocean, and XIOS components of the coupled suite. XIOS is running in <code class="docutils literal notranslate"><span class="pre">multiple-file</span></code> mode with 6 servers.</p>
<ul class="simple">
<li><p>Can you see where the NEMO model settings appear?</p></li>
</ul>
<p>Look under <span class="guilabel">Run settings (namrun)</span>. The variables <code class="docutils literal notranslate"><span class="pre">nn_stock</span></code> and <code class="docutils literal notranslate"><span class="pre">nn_write</span></code> control the frequency of output files.</p>
<ul class="simple">
<li><p>How often are NEMO restart files written?</p></li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The NEMO timestep length is set as variable <code class="docutils literal notranslate"><span class="pre">rn_rdt</span></code></p>
</div>
<p>Now browse the CICE settings.</p>
<ul class="simple">
<li><p>Can you find what the CICE restart frequency is set to?</p></li>
</ul>
<p>NEMO, CICE and XIOS are developed separately from the UM, and you should have seen that they work in very different ways. See the following websites for documentation:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://oceans11.lanl.gov/trac/CICE">http://oceans11.lanl.gov/trac/CICE</a></p></li>
<li><p><a class="reference external" href="http://www.nemo-ocean.eu/">http://www.nemo-ocean.eu/</a></p></li>
<li><p><a class="reference external" href="https://forge.ipsl.jussieu.fr/ioserver">https://forge.ipsl.jussieu.fr/ioserver</a></p></li>
</ul>
</div>
<div class="section" id="output-files">
<h3>Output files<a class="headerlink" href="#output-files" title="Permalink to this headline">¶</a></h3>
<p><strong>Log files</strong></p>
<p>NEMO logging information is written to:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">~/cylc-run/&lt;suitename&gt;/work/&lt;cycle&gt;/coupled/ocean.output</span></code></p>
</div></blockquote>
<p>CICE logging information is written to:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">~/cylc-run/&lt;suitename&gt;/work/&lt;cycle&gt;/coupled/ice_diag.d</span></code></p>
</div></blockquote>
<p>If the model fails some error messages may also be written to the file <code class="docutils literal notranslate"><span class="pre">~/cylc-run/&lt;suitename&gt;/work/&lt;cycle&gt;/coupled/debug.root.01</span></code> or <code class="docutils literal notranslate"><span class="pre">debug.root.02</span></code></p>
<p>When something goes wrong with the coupled model it can be tricky to work out what has gone wrong. NEMO errors may not appear at the end of the file but will be flagged with the string <code class="docutils literal notranslate"><span class="pre">E</span> <span class="pre">R</span> <span class="pre">R</span> <span class="pre">O</span> <span class="pre">R</span></code>.</p>
<p><strong>Restart files</strong></p>
<p>Restart files go to the subdirectories <code class="docutils literal notranslate"><span class="pre">NEMOhist</span></code> and <code class="docutils literal notranslate"><span class="pre">CICEhist</span></code> in the standard data directory <code class="docutils literal notranslate"><span class="pre">~/cylc-run/&lt;suitename&gt;/share/data/History_Data</span></code>.</p>
<p><strong>Diagnostic files</strong></p>
<p>Diagnostic files are left in the <code class="docutils literal notranslate"><span class="pre">~/cylc-run/&lt;suitename&gt;/work/&lt;cycle&gt;/coupled/</span></code> directory.</p>
<p>CICE files start with <code class="docutils literal notranslate"><span class="pre">&lt;suitename&gt;i</span></code>. Once your suite has run you should see the following CICE file (and more):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>archer$ ls ce119i*
ce119i.10d.1850-01-10.nc
</pre></div>
</div>
<p>NEMO diagnostic files are named <code class="docutils literal notranslate"><span class="pre">&lt;suitename&gt;o*grid_[TUVW]*</span></code>. To see what files are produced, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>archer$ ls ce119o*grid*
</pre></div>
</div>
<p>In this case each XIOS IO server writes to a separate file. To concatenate these into a global file use the <code class="docutils literal notranslate"><span class="pre">rebuild_nemo</span></code> tool, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>archer$ rebuild_nemo rebuild_nemo ce119o_1m_18500101_18500330_grid_T_185001-185001 6
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The coupled atmos-ocean model setup is complex so we recommend you find a suite already setup for your needs.  If you find you do need to modify a coupled suite setup please contact NCAS-CMS for advice.</p>
</div>
</div>
</div>
<div class="section" id="running-the-nesting-suite">
<h2><span class="section-number">7.5. </span>Running the Nesting Suite<a class="headerlink" href="#running-the-nesting-suite" title="Permalink to this headline">¶</a></h2>
<p>The Nesting Suite drives a series of nested limited area models (LAM) from a global model.  It allows the user to specify the domains and it then automatically creates the required ancillary files and lateral boundary condition files.</p>
<div class="section" id="id1">
<h3>Checkout and run the suite<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Checkout and open the suite <code class="docutils literal notranslate"><span class="pre">u-ce122</span></code>.  There are a number of tasks for creating ancillary files (<code class="docutils literal notranslate"><span class="pre">ancil_*</span></code> and <code class="docutils literal notranslate"><span class="pre">ants_*</span></code>).  The global model set up is in <span class="guilabel">glm_um</span> and the LAMs are in <span class="guilabel">um</span>.  The task <code class="docutils literal notranslate"><span class="pre">um-createbc</span></code> creates the lateral boundary condition files.</p>
<p>Under <span class="guilabel">suite conf –&gt; jinja2:suite.rc</span> are the main panels for controlling the Nesting Suite. Make the usual changes required to run the suite (i.e. set username, account code, queue).</p>
<p>If following the tutorial as part of an organised training event, select one of the special queues, otherwise, select the <code class="docutils literal notranslate"><span class="pre">short</span></code> queue.</p>
<p><span class="guilabel">Run</span> the suite.</p>
<p>This particular suite has a global model and one limited area model. It should complete in about 45 - 60 minutes.</p>
</div>
<div class="section" id="id2">
<h3>Exploring the Suite<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The Driving Model set up panel allows the user to specify the resolution of the global model and the number of nested regions.</p>
<p>The <span class="guilabel">Nested Region 1</span> set up panel specifies the latitude and longitude of the centre of the first nested region.  All the other limited area models have the same centre.</p>
<p>A useful way to get this information is to use Google Maps.  Find the place you want as a centre and then press <code class="docutils literal notranslate"><span class="pre">control-left</span> <span class="pre">mouse</span></code> and a little window with the latitude and longitude appears.</p>
<blockquote>
<div><ul class="simple">
<li><p>Can you find out where the first LAM is located?</p></li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Look at the orography file output during the ancillary creation.</p>
</div>
</div></blockquote>
<p>The <span class="guilabel">resolution 1</span> set up panel specifies the grid and the run length.</p>
<p>The <span class="guilabel">Config 1</span> set up panel specifies the science configuration to be run.  Each LAM can have multiple science configurations.</p>
</div>
<div class="section" id="initial-data">
<h3>Initial Data<a class="headerlink" href="#initial-data" title="Permalink to this headline">¶</a></h3>
<p>The initial data for the global model is in <code class="docutils literal notranslate"><span class="pre">share/cycle/&lt;cycle</span> <span class="pre">time&gt;/glm/ics</span></code></p>
<p>The initial data for the first LAM is in <code class="docutils literal notranslate"><span class="pre">share/cycle/&lt;cycle</span> <span class="pre">time&gt;/Regn1/resn_1/RA1M/ics</span></code></p>
<p>The RA1M is the name you gave to the first science configuration.</p>
<p>The LBCs for the first LAM are in <code class="docutils literal notranslate"><span class="pre">share/cycle/&lt;cycle</span> <span class="pre">time&gt;/Regn1/resn_1/RA1M/lbcs</span></code>.</p>
</div>
<div class="section" id="the-ancillary-files">
<h3>The ancillary files<a class="headerlink" href="#the-ancillary-files" title="Permalink to this headline">¶</a></h3>
<p>These are in <code class="docutils literal notranslate"><span class="pre">share/data/ancils/Regn1/resn_1</span></code></p>
</div>
<div class="section" id="the-output-files">
<h3>The output files<a class="headerlink" href="#the-output-files" title="Permalink to this headline">¶</a></h3>
<p>The global model output is in <code class="docutils literal notranslate"><span class="pre">share/cycle/&lt;cycle</span> <span class="pre">time&gt;/glm/um</span></code>. This also contains contains the data for creating the LBC files (<code class="docutils literal notranslate"><span class="pre">umglaa_cb*</span></code>) for the first LAM.</p>
<p>Diagnostic files can be found under <code class="docutils literal notranslate"><span class="pre">work/&lt;cycle</span> <span class="pre">time&gt;</span></code> in an application directory.  For example, the region1 forecast diagnostics is in <code class="docutils literal notranslate"><span class="pre">work/&lt;cycle</span> <span class="pre">time&gt;/Regn1_resn_1_RA1M_um_fcst_000</span></code>. This will include the pe_output files.</p>
<p>The output for the first LAM is in <code class="docutils literal notranslate"><span class="pre">share/cycle/&lt;cycle</span> <span class="pre">time&gt;/Regn1/resn_1/RA1M/um</span></code>.</p>
</div>
<div class="section" id="further-information">
<h3>Further Information<a class="headerlink" href="#further-information" title="Permalink to this headline">¶</a></h3>
<p>This has been a very brief overview of the functionality of the Nesting Suite. The Nesting Suite is developed and maintained by Stuart Webster at the Met Office.  He has a web page all about the Nesting Suite at <a class="reference external" href="https://code.metoffice.gov.uk/trac/rmed/wiki/suites/nesting">https://code.metoffice.gov.uk/trac/rmed/wiki/suites/nesting</a>. This includes a more detailed tutorial.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="rose-cylc-exercises.html" class="btn btn-neutral float-right" title="8. Rose/Cylc Exercises" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="further-exercises-1.html" class="btn btn-neutral float-left" title="6. Further Exercises (1)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017-2021, NCAS-CMS.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>